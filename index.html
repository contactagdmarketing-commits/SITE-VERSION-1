<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidalib - Location de véhicule à double commande pour candidats libres</title>
    <meta name="description" content="Candidalib propose la location de véhicules à double commande pour candidats libres au permis de conduire. Leçons de conduite à 35€/h ou forfait 10h à 300€.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <a href="index.html" class="logo">
                        <img src="assets/logocandi.jpg" alt="Candidalib" class="logo-img">
                    </a>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html" class="nav-link active">Accueil</a></li>
                    <li><a href="vehicules.html" class="nav-link">Nos véhicules</a></li>
                    <li><a href="candidat-libre.html" class="nav-link">Candidat libre</a></li>
                    <li><a href="tunnel.html" class="nav-link btn-nav">Inscription</a></li>
                </ul>
                <button class="menu-toggle" aria-label="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
        <!-- Floating CTA Bar -->
        <div class="floating-cta" id="floatingCta">
            <div class="container">
                <div class="floating-cta-content">
                    <span class="floating-cta-text">Prêt à commencer ?</span>
                    <a href="tunnel.html" class="btn btn-primary">Prendre rendez-vous</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <div class="hero-badge"><span class="icon-sparkle"></span> Solution économique pour candidats libres</div>
                <h1 class="hero-title">Louer un véhicule à double commande</h1>
                <h2 class="hero-subtitle">avec la solution <span class="highlight">Candidalib</span></h2>
                <p class="hero-description">Préparez votre permis de conduire en toute liberté et à moindre coût</p>
            </div>
        </div>
    </section>

    <!-- Notre Concept -->
    <section class="concept-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">NOTRE CONCEPT</h2>
                <h3 class="section-subtitle">Louer sa voiture auto-école, c'est moins cher.</h3>
            </div>
            <div class="concept-content">
                <div class="concept-image">
                    <img src="assets/concept-image.svg" alt="Véhicule à double commande pour apprentissage de la conduite">
                </div>
                <div class="concept-text">
                    <p>Préparez votre permis sans vous ruiner. Candidalib vous permet de louer un véhicule à double commande aux normes
                    
                    </p>
                    <p><strong>Pas d'accompagnateur ?</strong> Nous vous fournissons un Accompagnateur expérimenté qui vous suivra tout au long de votre formation.</p>
                    <a href="candidat-libre.html" class="btn btn-secondary">Découvrir notre concept</a>
                </div>
            </div>
        </div>
    </section>


    <!-- Pourquoi Nous -->
    <section class="why-section" id="tarifs">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Pourquoi nous ?</h2>
                <p class="section-intro">Des tarifs transparents, sans surprise</p>
            </div>
            <div class="pricing-cards">
                <div class="pricing-card clickable-card" onclick="window.location.href='contact.html'">
                    <div class="card-badge">1H</div>
                    <div class="card-icon"><img src="assets/logo-tortue.svg" alt="Tortue" style="width: 155%; height: 155%; object-fit: contain; transform: translateX(-2%) translateY(1%);"></div>
                    <h3 class="card-title">Session d'une heure</h3>
                    <p class="card-price">À partir de <strong>35€</strong></p>
                    <ul class="card-features">
                        <li><span class="icon-check"></span> Flexibilité totale</li>
                        <li><span class="icon-check"></span> Réservation rapide</li>
                        <li><span class="icon-check"></span> Sans engagement</li>
                    </ul>
                    <p class="card-description">Idéal pour des séances ponctuelles de perfectionnement</p>
                </div>
                <div class="pricing-card featured clickable-card" onclick="window.location.href='contact.html'">
                    <div class="card-badge">Formule 10H</div>
                    <div class="card-icon"><img src="assets/logo-lievre.svg" alt="Lièvre" style="width: 217%; height: 217%; object-fit: contain; transform: translateX(3%);"></div>
                    <h3 class="card-title">Forfait 10 heures</h3>
                    <p class="card-price">À partir de <strong>30€/h</strong></p>
                    <div class="card-savings">Économisez 50€</div>
                    <ul class="card-features">
                        <li><span class="icon-check"></span> Meilleur rapport qualité/prix</li>
                        <li><span class="icon-check"></span> Examens blancs inclus</li>
                        <li><span class="icon-check"></span> Suivi personnalisé</li>
                    </ul>
                    <p class="card-description">Économisez avec notre forfait le plus avantageux</p>
                </div>
                <div class="pricing-card clickable-card" onclick="window.location.href='contact.html'">
                    <div class="card-badge">EXAMEN</div>
                    <div class="card-icon"><img src="assets/logo-examen.svg" alt="Examen" style="width: 150%; height: 150%; object-fit: contain;"></div>
                    <h3 class="card-title">Présentation à l'examen</h3>
                    <p class="card-price">À partir de <strong>70€</strong></p>
                    <ul class="card-features">
                        <li><span class="icon-check"></span> Entraînement sur parcours</li>
                        <li><span class="icon-check"></span> Révision complète</li>
                        <li><span class="icon-check"></span> Confiance maximale</li>
                    </ul>
                    <p class="card-description">Préparez-vous sereinement pour le jour J</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Concepts détaillés -->
    <section class="concepts-detailed">
        <div class="container">
            <!-- Candidat libre -->
            <div class="concept-block">
                <div class="concept-illustration">
                    <img src="assets/mascotte-jeune.svg" alt="Illustration candidat libre jeune">
                </div>
                <div class="concept-details">
                    <div class="concept-block-header">
                        <h2 class="section-title">L'épreuve de la conduite en candidat libre</h2>
                        <h3 class="section-subtitle">NOTRE CONCEPT</h3>
                    </div>
                    <div class="concept-block-content">
                        <p>Optimisez votre préparation au permis, simplement.</p>
                            Avec Candidalib, ajoutez des heures de conduite </strong>pratiques</strong> et </strong>abordables</strong> pour compléter votre formation, à votre rythme.</p>
                            Que vous soyez inscrit en auto-école </strong>ou non</strong>, vous pouvez conduire davantage, mieux maîtriser vos heures, et vous préparer sereinement à l’examen pratique..</p>
                        <div class="conditions-box">
                            <h4>CONDITIONS</h4>
                            <p><strong>Apprenti :</strong> Avoir fait sa demande de permis sur www.ants.gouv.fr</p>
                            <p><strong>Accompagnateur :</strong> Être titulaire du permis de conduire depuis plus de 5 ans</p>
                        </div>
                        <a href="contact.html" class="btn btn-secondary">En savoir plus</a>
                    </div>
                </div>
            </div>

            <!-- Remise à niveau -->
            <div class="concept-block reverse" id="remise-niveau">
                <div class="concept-illustration">
                    <img src="assets/mascotte-adulte.svg" alt="Illustration remise à niveau adulte">
                </div>
                <div class="concept-details">
                    <div class="concept-block-header">
                        <h2 class="section-title">Vous êtes en remise à niveau</h2>
                        <h3 class="section-subtitle">NOTRE CONCEPT</h3>
                    </div>
                    <div class="concept-block-content">
                        <p>Vous avez déjà votre permis, mais la confiance au volant s’est estompée ?</p>
                         <p>Avec Candidalib, reprenez la route sereinement.</p>
                          <p>Nos accompagnateurs, qualifiés pour ces situations, sauront vous redonner l’assurance que vous méritez. Louez nos véhicules double commande, concentrez-vous sur ce qui est essentiel, et reprenez la main en toute confiance.</p>
                        <div class="conditions-box">
                            <h4>CONDITIONS</h4>
                            <p><strong>Apprenti :</strong> Être titulaire du permis</p>
                            <p><strong>Accompagnateur :</strong> Être titulaire du permis depuis plus de 5 ans</p>
                        </div>
                        <div style="display: flex; gap: var(--space-4); margin-top: var(--space-6); flex-wrap: wrap;">
                            <a href="#tarifs" onclick="document.querySelector('.pricing-card:nth-child(2)').classList.add('featured'); document.querySelector('#tarifs').scrollIntoView({behavior: 'smooth'});" class="btn btn-primary">Voir nos tarifs</a>
                            <a href="contact.html" class="btn btn-secondary">Nous contacter</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conduite supervisée -->
            <div class="concept-block" id="conduite-accompagnee">
                <div class="concept-illustration">
                    <img src="assets/mascotte-supervisee.svg" alt="Illustration conduite supervisée">
                </div>
                <div class="concept-details">
                    <div class="concept-block-header">
                        <h2 class="section-title">Vous passez le permis ACC, 16 ans ou conduite supervisée</h2>
                        <h3 class="section-subtitle">NOTRE CONCEPT</h3>
                    </div>
                    <div class="concept-block-content">
                        <p>Vous venez de valider la durée initiale de formation avec votre auto-école et vous vous apprêtez à conduire officiellement avec l'un de vos proches sur les voies publiques. Mais ces dernièrs ne sont pas disponibles ? .</p>
                        <p>Avec Candidalib, vous pouvez conduire avec l'un de nos accompagnateurs qualifiés, qui vous suivront tout au long de votre formation.</p>
                        <div class="conditions-box">
                            <h4>CONDITIONS</h4>
                            <p><strong>Apprenti :</strong> Avoir effectué 20h en auto-école</p>
                            <p><strong>Accompagnateur :</strong> Être titulaire du permis de conduire depuis plus de 5 ans</p>
                        </div>
                        <a href="contact.html" class="btn btn-secondary" style="margin-top: var(--space-6); display: inline-block;">En savoir plus</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section Examen -->
    <section class="exam-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">vous aller bientôt passer votre examen ?</h2>
            </div>
            <div class="exam-tabs">
                <button class="exam-tab active" data-tab="no-date">Vous n'avez pas encore de date d'examen</button>
                <button class="exam-tab" data-tab="has-date">Vous avez une date d'examen</button>
            </div>
            <div class="exam-content">
                <div class="exam-panel active" id="no-date">
                    <p>Vous avez effectué les 20h obligatoires en auto-école avec un professionnel et vous souhaitez perfectionner votre conduite à petit prix pour obtenir une date d'examen. Louez nos véhicules école afin de compléter votre formation en auto-école, vous pourrez alors conduire quand vous le souhaitez et revoir tous les points que vous avez traités lors de apprentissage dans votre auto-école.</p>
                    <p>La location de nos véhicules à double commande permet :</p>
                    <ul class="benefits-list">
                        <li>De mieux assimiler les objectifs non atteints lors de votre apprentissage dans votre auto-école</li>
                        <li>De faire des économies considérables</li>
                        <li>De vous faire gagner de la confiance et de l'assurance</li>
                    </ul>
                </div>
                <div class="exam-panel" id="has-date">
                    <p>Louez nos véhicules auto-école afin de vous entraîner à toute heure à moindre coût. Vous pourrez vous entraîner sur votre lieu d'examen tout en étant accompagné de la personne de votre choix. Le parcours de votre examen n'aura plus aucun secret pour vous le jour J.</p>
                    <p>La solution Candidalib permet :</p>
                    <ul class="benefits-list">
                        <li>De réduire le coût excessif des heures supplémentaires de votre auto-école</li>
                        <li>De faire des économies</li>
                        <li>De renforcer votre apprentissage</li>
                        <li>D'augmenter la durée de conduite sur votre lieu d'examen</li>
                        <li>D'augmenter votre confiance</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 class="footer-title">CANDIDALIB</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Découvrez-nous</a></li>
                        <li><a href="index.html">Notre Concept</a></li>
                        <li><a href="vehicules.html">Nos véhicules</a></li>
                        <li><a href="index.html">Nos tarifs</a></li>
                        <li><a href="candidat-libre.html">Candidat libre</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3 class="footer-title">L'actualité</h3>
                    <ul class="footer-links">
                        <li><a href="mentions-legales.html">Mentions Légales</a></li>
                        <li><a href="cgu.html">CGU</a></li>
                        <li><a href="confidentialite.html">Politique de confidentialité</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3 class="footer-title">Suivez-nous !</h3>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook">Facebook</a>
                        <a href="#" aria-label="Instagram">Instagram</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Candidalib. Tous droits réservés.</p>
            </div>
        </div>
    </footer>

    <script>
        // Fonction pour gérer les redirections du tunnel
        window.addEventListener('DOMContentLoaded', function() {
            // Gérer la mise en avant des cartes selon les paramètres URL
            const urlParams = new URLSearchParams(window.location.search);
            const highlight = urlParams.get('highlight');
            
            if (highlight) {
                // Retirer la classe featured de toutes les cartes
                document.querySelectorAll('.pricing-card').forEach(card => {
                    card.classList.remove('featured');
                });
                
                // Ajouter la classe featured à la bonne carte
                const pricingCards = document.querySelectorAll('.pricing-card');
                if (highlight === 'session' && pricingCards[0]) {
                    pricingCards[0].classList.add('featured');
                } else if (highlight === 'forfait10h' && pricingCards[1]) {
                    pricingCards[1].classList.add('featured');
                } else if (highlight === 'examen' && pricingCards[2]) {
                    pricingCards[2].classList.add('featured');
                }
            }
            
            // Gérer le scroll vers les sections spécifiques
            const hash = window.location.hash;
            if (hash) {
                setTimeout(() => {
                    const targetId = hash.substring(1);
                    let targetElement = null;
                    
                    if (targetId === 'tarifs') {
                        targetElement = document.querySelector('#tarifs');
                    } else if (targetId === 'conduite-accompagnee') {
                        targetElement = document.querySelector('#conduite-accompagnee');
                    } else if (targetId === 'remise-niveau') {
                        targetElement = document.querySelector('#remise-niveau');
                    }
                    
                    if (targetElement) {
                        // Scroll avec un offset pour le header fixe
                        const yOffset = -100; 
                        const y = targetElement.getBoundingClientRect().top + window.pageYOffset + yOffset;
                        window.scrollTo({ top: y, behavior: 'smooth' });
                    }
                }, 300);
            }
        });
    </script>

    <!-- Tunnel Modal Pop-up -->
    <div id="tunnel-modal" class="tunnel-modal">
        <div class="tunnel-modal-overlay"></div>
        <div class="tunnel-modal-content">
            <button class="tunnel-modal-close" id="close-tunnel">&times;</button>
            
            <div class="tunnel-card-modal">
                <div class="tunnel-header">
                    <h1>Trouvez votre formule idéale</h1>
                </div>

                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step-dot active" data-step-dot="0"></div>
                    <div class="step-dot" data-step-dot="1"></div>
                    <div class="step-dot" data-step-dot="2"></div>
                </div>

                <!-- Form -->
                <form id="tunnel-form-modal">
                    <!-- ÉTAPE 0 : Situation de base -->
                    <div class="tunnel-step active" data-step="0">
                        <h2 class="step-question">Où en êtes-vous ?</h2>
                        <p class="step-description">Choisissez votre situation</p>
                        
                        <div class="options-grid">
                            <label class="option-card">
                                <input type="radio" name="base" value="passer" required>
                                <span class="option-title">Je souhaite passer mon permis</span>
                                <span class="option-description">Je n'ai pas encore le permis de conduire</span>
                            </label>
                            
                            <label class="option-card">
                                <input type="radio" name="base" value="ai-permis" required>
                                <span class="option-title">J'ai déjà mon permis</span>
                                <span class="option-description">J'ai besoin d'une remise à niveau</span>
                            </label>
                        </div>
                    </div>

                    <!-- Étapes dynamiques générées par JavaScript -->
                    <div id="dynamic-steps-modal"></div>
                </form>

                <!-- Navigation -->
                <div class="tunnel-navigation">
                    <button type="button" id="btn-prev-modal" class="btn-tunnel btn-tunnel-secondary" style="display: none;">
                        ← Précédent
                    </button>
                    <div style="flex: 1;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // TUNNEL MODAL - GESTION
        // ==========================================
        const tunnelModal = document.getElementById('tunnel-modal');
        const closeTunnelBtn = document.getElementById('close-tunnel');
        const modalOverlay = document.querySelector('.tunnel-modal-overlay');

        // Ouvrir la modale
        function openTunnelModal() {
            tunnelModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Fermer la modale
        function closeTunnelModal() {
            tunnelModal.classList.remove('active');
            document.body.style.overflow = '';
            // Marquer que la modale a été fermée pour cette session
            sessionStorage.setItem('tunnelClosed', 'true');
        }

        // Ouvrir automatiquement au chargement de la page
        window.addEventListener('DOMContentLoaded', function() {
            // Ne pas ouvrir si la modale a déjà été fermée dans cette session
            // OU s'il y a un hash/query dans l'URL (redirection du tunnel)
            const wasClosed = sessionStorage.getItem('tunnelClosed');
            const hasUrlParams = window.location.hash || window.location.search;
            
            if (!wasClosed && !hasUrlParams) {
                openTunnelModal();
            }
        });

        // Fermer avec le bouton X
        closeTunnelBtn.addEventListener('click', closeTunnelModal);

        // Fermer en cliquant sur l'overlay
        modalOverlay.addEventListener('click', closeTunnelModal);

        // Modifier tous les boutons "Prendre rendez-vous" pour ouvrir la modale
        document.querySelectorAll('a[href="tunnel.html"], a[href*="tunnel.html"]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                openTunnelModal();
            });
        });

        // ==========================================
        // TUNNEL LOGIC - ARBRE DE DÉCISION
        // ==========================================
        const formModal = document.getElementById('tunnel-form-modal');
        const dynamicStepsModal = document.getElementById('dynamic-steps-modal');
        const btnPrevModal = document.getElementById('btn-prev-modal');
        let currentStepIndexModal = 0;
        let userChoicesModal = {};
        let stepsHistoryModal = [];

        // Arbre de décision complet
        const flowTreeModal = {
            'passer': {
                question: "Quelle est votre situation actuelle ?",
                description: "Précisez votre parcours",
                options: [
                    { value: 'ai-auto-ecole', title: "J'ai déjà une auto-école", description: "Je suis inscrit dans une auto-école" },
                    { value: 'pas-auto-ecole', title: "Non, je n'ai pas d'auto-école", description: "Je souhaite me former autrement" },
                    { value: 'conduite-accompagnee', title: "Je suis en conduite accompagnée/supervisée sans accompagnateur", description: "J'ai besoin d'un accompagnateur équipé" }
                ],
                next: (choice) => {
                    if (choice === 'ai-auto-ecole') return 'auto-ecole-action';
                    if (choice === 'pas-auto-ecole') return 'pas-auto-ecole-detail';
                    if (choice === 'conduite-accompagnee') return 'REDIRECT:index.html#conduite-accompagnee';
                }
            },
            'auto-ecole-action': {
                question: "Que souhaitez-vous faire ?",
                description: "Choisissez votre besoin",
                options: [
                    { value: 'heures-supp', title: "Je souhaite faire des heures supplémentaires", description: "Complément à ma formation actuelle" },
                    { value: 'transfert', title: "Je souhaite transférer mon dossier", description: "Changer d'établissement" }
                ],
                next: (choice) => {
                    if (choice === 'heures-supp') return 'heures-deja-faites';
                    if (choice === 'transfert') return 'REDIRECT:candidat-libre.html?action=transfert';
                }
            },
            'heures-deja-faites': {
                question: "Combien d'heures avez-vous déjà effectuées ?",
                description: "Pour mieux vous orienter",
                options: [
                    { value: 'moins-20', title: "Moins de 20 heures", description: "Début de formation" },
                    { value: 'plus-20', title: "Plus de 20 heures", description: "Formation avancée" }
                ],
                next: () => 'heures-besoin'
            },
            'heures-besoin': {
                question: "Combien d'heures pensez-vous avoir besoin ?",
                description: "Choisissez votre formule",
                options: [
                    { value: '1-5', title: "Entre 1 et 5 heures", description: "Quelques sessions de perfectionnement" },
                    { value: '5-10', title: "Entre 5 et 10 heures", description: "Programme de préparation" },
                    { value: 'plus-10', title: "Plus de 10 heures", description: "Formation complète" }
                ],
                next: (choice) => {
                    if (choice === '1-5') return 'REDIRECT:index.html?highlight=session#tarifs';
                    return 'REDIRECT:index.html?highlight=forfait10h#tarifs';
                }
            },
            'pas-auto-ecole-detail': {
                question: "Souhaitez-vous être accompagné ?",
                description: "Précisez votre besoin",
                options: [
                    { value: 'besoin-accompagnateur', title: "Oui, j'ai besoin d'un accompagnateur", description: "Je n'ai personne pour m'accompagner" },
                    { value: 'ai-accompagnateur', title: "Non, j'ai déjà un accompagnateur", description: "Une personne peut m'accompagner" }
                ],
                next: (choice) => {
                    if (choice === 'besoin-accompagnateur') return 'REDIRECT:contact.html';
                    return 'REDIRECT:candidat-libre.html?action=contact';
                }
            }
        };

        // Générer une étape dynamique
        function generateStepModal(stepKey) {
            const stepData = flowTreeModal[stepKey];
            if (!stepData) return;

            const stepHTML = `
                <div class="tunnel-step active" data-step-key="${stepKey}">
                    <h2 class="step-question">${stepData.question}</h2>
                    <p class="step-description">${stepData.description}</p>
                    <div class="options-grid">
                        ${stepData.options.map(opt => `
                            <label class="option-card">
                                <input type="radio" name="${stepKey}" value="${opt.value}" required>
                                <span class="option-title">${opt.title}</span>
                                <span class="option-description">${opt.description}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;

            dynamicStepsModal.innerHTML = stepHTML;
            setupOptionListenersModal();
        }

        // Configurer les listeners pour les options
        function setupOptionListenersModal() {
            const dynamicInputs = dynamicStepsModal.querySelectorAll('input[type="radio"]');
            dynamicInputs.forEach(input => {
                input.addEventListener('change', () => {
                    document.querySelectorAll(`input[name="${input.name}"]`).forEach(i => {
                        i.closest('.option-card').classList.toggle('selected', i === input);
                    });
                    userChoicesModal[input.name] = input.value;
                    
                    setTimeout(() => {
                        goToNextStepModal();
                    }, 400);
                });
            });
        }

        // Naviguer vers la prochaine étape
        function goToNextStepModal() {
            const currentStep = document.querySelector('#dynamic-steps-modal .tunnel-step.active');
            if (!currentStep) return;
            
            const stepKey = currentStep.dataset.stepKey;
            const currentChoice = userChoicesModal[stepKey];
            const stepData = flowTreeModal[stepKey];
            const nextKey = stepData ? stepData.next(currentChoice) : null;
            
            // Gérer les redirections
            if (nextKey && nextKey.startsWith('REDIRECT:')) {
                const url = nextKey.replace('REDIRECT:', '');
                closeTunnelModal();
                window.location.href = url;
                return;
            }
            
            stepsHistoryModal.push(stepKey);
            currentStep.classList.remove('active');
            
            if (nextKey) {
                generateStepModal(nextKey);
                currentStepIndexModal++;
                updateStepIndicatorsModal();
                updatePrevButtonModal();
            }
        }

        // Retour en arrière
        function goToPreviousStepModal() {
            if (stepsHistoryModal.length === 0) {
                const allSteps = Array.from(document.querySelectorAll('.tunnel-step'));
                allSteps.forEach(s => s.classList.remove('active'));
                allSteps[0].classList.add('active');
                currentStepIndexModal = 0;
                dynamicStepsModal.innerHTML = '';
            } else {
                const previousKey = stepsHistoryModal.pop();
                const allSteps = Array.from(document.querySelectorAll('.tunnel-step'));
                allSteps.forEach(s => s.classList.remove('active'));
                
                if (stepsHistoryModal.length === 0) {
                    allSteps[0].classList.add('active');
                    currentStepIndexModal = 0;
                    dynamicStepsModal.innerHTML = '';
                } else {
                    generateStepModal(previousKey);
                    currentStepIndexModal--;
                }
            }
            updateStepIndicatorsModal();
            updatePrevButtonModal();
        }

        // Mettre à jour les indicateurs
        function updateStepIndicatorsModal() {
            const stepDots = Array.from(document.querySelectorAll('#tunnel-modal .step-dot'));
            stepDots.forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index < currentStepIndexModal) {
                    dot.classList.add('completed');
                } else if (index === currentStepIndexModal) {
                    dot.classList.add('active');
                }
            });
        }

        // Mettre à jour le bouton précédent
        function updatePrevButtonModal() {
            btnPrevModal.style.display = currentStepIndexModal === 0 ? 'none' : 'block';
        }

        // Gérer le premier choix
        document.querySelectorAll('#tunnel-form-modal input[name="base"]').forEach(input => {
            input.addEventListener('change', () => {
                document.querySelectorAll('#tunnel-form-modal input[name="base"]').forEach(i => {
                    i.closest('.option-card').classList.toggle('selected', i === input);
                });
                userChoicesModal.base = input.value;
                
                setTimeout(() => {
                    const baseChoice = userChoicesModal.base;
                    if (baseChoice === 'ai-permis') {
                        closeTunnelModal();
                        window.location.href = 'index.html#remise-niveau';
                    } else if (baseChoice === 'passer') {
                        // Masquer la première étape
                        const firstStep = document.querySelector('#tunnel-form-modal .tunnel-step[data-step="0"]');
                        if (firstStep) {
                            firstStep.classList.remove('active');
                        }
                        
                        stepsHistoryModal.push('base');
                        generateStepModal('passer');
                        currentStepIndexModal++;
                        updateStepIndicatorsModal();
                        updatePrevButtonModal();
                    }
                }, 400);
            });
        });

        // Bouton précédent
        btnPrevModal.addEventListener('click', goToPreviousStepModal);
    </script>

    <script src="script.js"></script>
</body>
</html>
